"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=run,exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_useInternalEngine=require("./useInternalEngine"),minRemainingTime=1.75;function run(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length?arguments[2]:void 0,d=!1,e=null,f=new Promise(function(f,g){function h(){return i.apply(this,arguments)}function i(){return i=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function a(e){var i,o,p,q;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!n){a.next=2;break}return a.abrupt("return");case 2:if(a.prev=2,n=!0,clearTimeout(l),!d){a.next=8;break}return k.return(),a.abrupt("return");case 8:i=Math.max(minRemainingTime,b),a.prev=9;case 10:if(!(e.timeRemaining()>i)){a.next=29;break}return a.t0=k,a.next=14,m;case 14:if(a.t1=a.sent,o=a.t0.next.call(a.t0,a.t1),p=o.value,q=o.done,m=void 0,!q){a.next=22;break}return f(p),a.abrupt("return");case 22:if(!0!==p){a.next=26;break}return a.abrupt("break",29);case 26:"number"==typeof p?(i=+p,isNaN(i)&&(i=minRemainingTime)):p&&p.then&&(m=p);case 27:a.next=10;break;case 29:a.next=36;break;case 31:return a.prev=31,a.t2=a["catch"](9),console.error(a.t2),g(a.t2),a.abrupt("return");case 36:(0,_useInternalEngine.request)(h),c&&(l=setTimeout(j,c));case 38:return a.prev=38,n=!1,a.finish(38);case 41:case"end":return a.stop();}},a,null,[[2,,38,41],[9,31]])})),i.apply(this,arguments)}function j(){var a=Date.now();h({timeout:!0,timeRemaining:function timeRemaining(){return 12.5-(Date.now()-a)}})}e=f;var k=a.next?a:a();(0,_useInternalEngine.request)(h);var l=0,m=void 0,n=!1});return f.terminate=function(a){d=!0,e&&e(a)},f}var _default=run;exports.default=_default;